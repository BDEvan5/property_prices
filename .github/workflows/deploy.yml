name: Deploy to GitHub Pages

# Defines when the workflow will run
on:
  push:
    branches: ['master']  # Trigger on pushes to main branch
  workflow_dispatch:    # Allow manual triggering from the GitHub UI


jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            # Check out the repository code
            - uses: actions/checkout@v5

            # Install uv package manager for faster Python package installation
            - name: ğŸš€ Install uv
              uses: astral-sh/setup-uv@v7

            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                python-version: '3.12'  # or your preferred version

            - name: Install dependencies
              run: |
                  uv sync

            - name: ğŸ“„ Export notebook
              run: |
                  uv run marimo export html web/property_price_visualisation.py -o web/output/index.html --no-include-code

            - name: ğŸ“¦ Upload Pages Artifact
              uses: actions/upload-pages-artifact@v3
              with:
                  path: web/output

    deploy:
        needs: build
        runs-on: ubuntu-latest
        environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}

        permissions:
            pages: write
            id-token: write

        steps:
            - name: ğŸŒ Deploy to GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4
              with:
                  artifact_name: github-pages